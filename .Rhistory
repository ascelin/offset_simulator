source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
set_seed = TRUE
perform_offsets = TRUE
if (set_seed == TRUE){
set.seed(123)
}
outs = list()
eco_ind = 1
outs$model_outputs <- calc_trajectories_multi(global_params, region_params, current_ecology, decline_rates,
parcels, index_object, perform_offsets, record_parcel_sets = TRUE)
parcel_sets_counterfactuals <- calc_parcel_set_counterfactuals(outs$model_outputs, global_params, decline_rates_initial)
outs$parcel_sets_object <- group_parcel_sets(outs$model_outputs, parcel_sets_counterfactuals, counterfactual_type = 'counterfactual', land_parcels, global_params, decline_rates_initial)
outs$collated_parcel_sets_object <- collate_parcel_sets(outs$parcel_sets_object, global_params, global_params$eco_dims)
filename = paste('~/Documents/', offset_calc_type , '_time_horizon_', global_params$offset_time_horizon, '_',
global_params$use_offset_time_horizon, '_include_avoided_clearing_', global_params$use_adjusted_counterfactual,
'.pdf', sep = '', collapse = '')
pdf(filename)
plot_all_parcel_sets(outs$collated_parcel_sets_object, assessed_set_indexes = (1:10), global_params)
plot_parcel_set_from_collated_object(outs$collated_parcel_sets_object, assessed_set_indexes = (1:global_params$total_dev_num), global_params, global_params$eco_dims)
outs$parcel_trajs <- find_parcel_trajectories(land_parcels, 1:(parcels$land_parcel_num), outs$model_outputs$trajectories[[eco_ind]])
par(mfrow = c(2, 1))
par(mar = c(6, 4, 2, 0), oma = c(0, 0, 0, 0))
NNL_object = outs$collated_parcel_sets_object$NNL_object
xl = t(cbind(paste('mean = ', round(mean(NNL_object$NNL_dist))), paste('success = ', NNL_object$success )))
hist(NNL_object$NNL_dist, main = '', xlab = xl)
hist(outs$collated_parcel_sets_object$offsets$initial_parcel_sums, main = '', xlab = 'initial offset parcel value')
#   parcel_sets_counterfactuals <- calc_parcel_set_counterfactuals(outs$model_outputs, global_params, decline_rates_initial)
#
#   outs$parcel_sets_object <- group_parcel_sets(outs$model_outputs, parcel_sets_counterfactuals, counterfactual_type = 'counterfactual', land_parcels, global_params, decline_rates_initial)
#
#   outs$collated_parcel_sets_object <- collate_parcel_sets(outs$parcel_sets_object, global_params, global_params$eco_dims)
#   outs$parcel_trajs <- find_parcel_trajectories(land_parcels, 1:(parcels$land_parcel_num), outs$model_outputs$trajectories[[eco_ind]])
setup_sub_plots(nx = 3, ny = 1)
total_parcel_sums = apply(outs$parcel_trajs, MARGIN = 1, sum)
total_counter_sums = apply(cfac_parcel_trajs, MARGIN = 1, sum)
plot_array = cbind(t(t(total_parcel_sums)), t(t(total_counter_sums)))
mx = max(plot_array)
mn = min(plot_array)
setup_sub_plots(nx = 1, ny = 2)
overlay_plots(plot_array, yticks = 'y', axis_lab = TRUE, ylims = c(mn, mx), (heading = "Net Ecological Value"), ylab = '', col_vec = c('black', 'black'),
lty_vec = c(1, 2), lwd_vec = c(1, 1), legend_vec = c('Offset Policy Assessment', 'Landscape Decline'), legend_loc = 'topright')
plot((total_parcel_sums - total_counter_sums), type = 'l', main = "Net NNL Assessment", ylab = '')
abline(h = 0, lty = 2)
if (set_seed == TRUE){
set.seed(123)
}
outs = list()
eco_ind = 1
outs$model_outputs <- calc_trajectories_multi(global_params, region_params, current_ecology, decline_rates,
parcels, index_object, perform_offsets, record_parcel_sets = TRUE)
parcel_sets_counterfactuals <- calc_parcel_set_counterfactuals(outs$model_outputs, global_params, decline_rates_initial)
outs$parcel_sets_object <- group_parcel_sets(outs$model_outputs, parcel_sets_counterfactuals, counterfactual_type = 'counterfactual', land_parcels, global_params, decline_rates_initial)
outs$collated_parcel_sets_object <- collate_parcel_sets(outs$parcel_sets_object, global_params, global_params$eco_dims)
filename = paste('~/Documents/', offset_calc_type , '_time_horizon_', global_params$offset_time_horizon, '_',
global_params$use_offset_time_horizon, '_include_avoided_clearing_', global_params$use_adjusted_counterfactual,
'.pdf', sep = '', collapse = '')
current_ecology = initial_ecology
decline_rates = decline_rates_initial
if (set_seed == TRUE){
set.seed(123)
}
outs = list()
eco_ind = 1
outs$model_outputs <- calc_trajectories_multi(global_params, region_params, current_ecology, decline_rates,
parcels, index_object, perform_offsets, record_parcel_sets = TRUE)
parcel_sets_counterfactuals <- calc_parcel_set_counterfactuals(outs$model_outputs, global_params, decline_rates_initial)
outs$parcel_sets_object <- group_parcel_sets(outs$model_outputs, parcel_sets_counterfactuals, counterfactual_type = 'counterfactual', land_parcels, global_params, decline_rates_initial)
outs$collated_parcel_sets_object <- collate_parcel_sets(outs$parcel_sets_object, global_params, global_params$eco_dims)
NNL_object = outs$collated_parcel_sets_object$NNL_object
xl = t(cbind(paste('mean = ', round(mean(NNL_object$NNL_dist))), paste('success = ', NNL_object$success )))
hist(NNL_object$NNL_dist, main = '', xlab = xl)
xl
par(mfrow = c(2, 1))
par(mar = c(6, 4, 2, 0), oma = c(0, 0, 0, 0))
NNL_object = outs$collated_parcel_sets_object$NNL_object
xl = t(cbind(paste('mean = ', round(mean(NNL_object$NNL_dist))), paste('success = ', NNL_object$success )))
hist(NNL_object$NNL_dist, main = '', xlab = xl)
xl
parcel_sets_counterfactuals <- calc_parcel_set_counterfactuals(outs$model_outputs, global_params, decline_rates_initial)
outs$parcel_sets_object <- group_parcel_sets(outs$model_outputs, parcel_sets_counterfactuals, counterfactual_type = 'counterfactual', land_parcels, global_params, decline_rates_initial)
outs$collated_parcel_sets_object <- collate_parcel_sets(outs$parcel_sets_object, global_params, global_params$eco_dims)
outs$collated_parcel_sets_object
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
perform_offsets = TRUE
set_seed = TRUE
current_ecology = initial_ecology
decline_rates =  decline_rates_initial
if (set_seed == TRUE){
set.seed(123)
}
outs = list()
eco_ind = 1
outs$model_outputs <- calc_trajectories_multi(global_params, region_params, current_ecology, decline_rates,
parcels, index_object, perform_offsets, record_parcel_sets = TRUE)
parcel_sets_counterfactuals <- calc_parcel_set_counterfactuals(outs$model_outputs, global_params, decline_rates_initial)
outs$parcel_sets_object <- group_parcel_sets(outs$model_outputs, parcel_sets_counterfactuals, counterfactual_type = 'counterfactual', land_parcels, global_params, decline_rates_initial)
outs$collated_parcel_sets_object <- collate_parcel_sets(outs$parcel_sets_object, global_params, global_params$eco_dims)
filename = paste('~/Documents/', offset_calc_type , '_time_horizon_', global_params$offset_time_horizon, '_',
global_params$use_offset_time_horizon, '_include_avoided_clearing_', global_params$use_adjusted_counterfactual,
'.pdf', sep = '', collapse = '')
pdf(filename)
plot_all_parcel_sets(outs$collated_parcel_sets_object, assessed_set_indexes = (1:10), global_params)
plot_parcel_set_from_collated_object(outs$collated_parcel_sets_object, assessed_set_indexes = (1:global_params$total_dev_num), global_params, global_params$eco_dims)
outs$parcel_trajs <- find_parcel_trajectories(land_parcels, 1:(parcels$land_parcel_num), outs$model_outputs$trajectories[[eco_ind]])
par(mfrow = c(2, 1))
par(mar = c(6, 4, 2, 0), oma = c(0, 0, 0, 0))
NNL_object = outs$collated_parcel_sets_object$NNL_object
xl = t(cbind(paste('mean = ', round(mean(NNL_object$NNL_dist))), paste('success = ', NNL_object$success )))
hist(NNL_object$NNL_dist, main = '', xlab = xl)
hist(outs$collated_parcel_sets_object$offsets$initial_parcel_sums, main = '', xlab = 'initial offset parcel value')
NNL_object$NNL_dist
plot_all_parcel_sets(outs$collated_parcel_sets_object, assessed_set_indexes = (1:10), global_params)
outs$collated_parcel_sets_object
graphics.off()
plot_all_parcel_sets(outs$collated_parcel_sets_object, assessed_set_indexes = (1:10), global_params)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
region_params
parcel_sets_counterfactuals <- calc_parcel_set_counterfactuals(outs$model_outputs, global_params, decline_rates_initial)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
yr = 1
current_ecology = initial_ecology
decline_rates = decline_rates_initial
perform_offsets = TRUE
record_parcel_sets = TRUE
region_ind = 1
current_dev_nums <- find_current_dev_nums(region_params, global_params$region_num, yr)
current_develop_num = current_dev_nums[region_ind]
land_parcels = parcels$land_parcels
time_horizon = 20
trajectories <- initialise_trajectories(global_params$eco_dims, global_params$ecology_size, global_params$time_steps, initial_ecologies)
offsets_object = list()
developments_object = list()
offset_devs_object <- find_developments_offsets(region_ind, global_params, region_params, current_ecology, decline_rates, parcels, index_object, perform_offsets, yr)
offset_devs_object
graphics.off()
outs$parcel_trajs
offset_devs_object
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
outs$collated_parcel_sets_object
outs$parcel_sets_object
outs$parcel_sets_object$offsets[[5]]$parcel_vals_used
outs$parcel_sets_object$developments[[5]]$parcel_vals_used
outs$parcel_sets_object$developments[[5]]$parcel_indexes
outs$parcel_sets_object$offsets[[5]]$parcel_indexes
outs$parcel_trajs
outs$parcel_sets_object$offsets[[5]]$parcel_indexes
plot(outs$parcel_sets_object$offsets[[5]]$parcel_indexes, type = 'l')
plot(outs$parcel_trajs[, 25], type = 'l')
outs$parcel_sets_object$developments[[5]]$parcel_indexes
outs$parcel_sets_object$developments[[5]]$yr
plot(outs$parcel_trajs[, 43], type = 'l')
plot(outs$parcel_trajs[, 25], type = 'l')
decline_rates_initial
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
par(mfrow = c(2, 1))
par(mar = c(6, 4, 2, 0), oma = c(0, 0, 0, 0))
NNL_object = outs$collated_parcel_sets_object$NNL_object
xl = t(cbind(paste('mean = ', round(mean(NNL_object$NNL_dist))), paste('success = ', NNL_object$success )))
hist(NNL_object$NNL_dist, main = '', xlab = xl)
hist(outs$collated_parcel_sets_object$offsets$initial_parcel_sums, main = '', xlab = 'initial offset parcel value')
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
a = -1:3
any(a >4)
any(a >3)
any(a >2)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
par(mfrow = c(3, 1))
par(mar = c(6, 4, 2, 0), oma = c(0, 0, 0, 0))
plot_parcel_set_from_collated_object(outs$collated_parcel_sets_object, assessed_set_indexes = (1:global_params$total_dev_num), global_params, global_params$eco_dims)
install.packages("rvest")
suppressMessages(library(rvest))
suppressMessages(library(dplyr))
suppressMessages(library(reshape2))
suppressMessages(library(googleVis))
install.packages("dplyr")
install.packages("reshape2")
install.packages("googleVis")
suppressMessages(library(rvest))
suppressMessages(library(dplyr))
suppressMessages(library(reshape2))
suppressMessages(library(googleVis))
webpage <- html("http://www.reed.edu/ir/geographic_states.html")
webpage <- read_html("http://www.reed.edu/ir/geographic_states.html")
webpage %>%
html_nodes("table") %>%
.[[1]] %>%
html_table()
webpage <- read_html("http://apps.webofknowledge.com.ezproxy.lib.rmit.edu.au/InterService.do?product=WOS&toPID=WOS&action=AllCitationService&isLinks=yes&highlighted_tab=WOS&last_prod=WOS&fromPID=UA&returnLink=http%3a%2f%2fapps.webofknowledge.com%2ffull_record.do%3fhighlighted_tab%3dUA%26page%3d1%26qid%3d2%26log_event%3dyes%26viewType%3dfullRecord%26SID%3dS1i2347sHVzWesr8rOe%26product%3dUA%26doc%3d2%26search_mode%3dGeneralSearch&srcDesc=RET2UA&srcAlt=Back+to+All+Databases&UT=WOS:000369001000016&search_mode=CitedRefList&SID=S1i2347sHVzWesr8rOe&parentProduct=UA&parentQid=2&parentDoc=2&recid=WOS:000369001000016&PREC_REFCOUNT=42&fromRightPanel=true")
webpage %>%
html_nodes("table") %>%
.[[1]] %>%
html_table()
webpage %>%
html_nodes("table") %>%
.[[1]] %>%
html_table(fill = TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/Global_Regional_Params.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/Global_Regional_Params.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
suppressMessages(library(rvest))
suppressMessages(library(dplyr))
suppressMessages(library(reshape2))
suppressMessages(library(googleVis))
webpage <- html("http://www.reed.edu/ir/geographic_states.html")
# the data we want is in the first table on this page
# the html_table() command coerces the data into a data frame
webpage %>%
html_nodes("table") %>%
.[[1]] %>%
html_table()
webpage <- read_html("http://www.reed.edu/ir/geographic_states.html")
# the data we want is in the first table on this page
# the html_table() command coerces the data into a data frame
webpage %>%
html_nodes("table") %>%
.[[1]] %>%
html_table()
webpage
data
webpage$node
webpage$node()
data <-
webpage %>%
html_nodes("table") %>%
.[[1]] %>%
html_table()
data$`2008`
data$`2013`
rm(list = ls())
WD = getwd()
strt<-Sys.time()
source('offsets_functions_current.R')
source('Global_Regional_Params.R')
.libPaths('~/Library/R/3.2/library')
library(foreach)
library(doParallel)
library(abind)
write_pdf = FALSE
print_folder = '~/Documents/'
realisation_num = 5
offset_calc_type = 'restoration_from_cfac'   #'avoided degredation', 'restoration_from_cfac', 'parcel_condition_value', 'restoration_gains', 'restoration_condition_value'
dev_calc_type = 'future_condition'                     #'future_condition', 'current_condition'
offset_action_type = 'maintain'                         #'protect', 'maintain', 'restore'
cfac_type = 'standard_cfac'               #'standard_cfac', 'include_clearing', 'include_clearing_offsets'
offset_time_horizon = 40
global_params <- initialise_global_params(offset_calc_type, dev_calc_type, offset_action_type, cfac_type, offset_time_horizon)
parcels <- initialise_shape_parcels(global_params)
land_parcels <- parcels$land_parcels
index_object <- initialise_index_object(parcels, global_params)
initial_ecology <- initialise_ecology(global_params, land_parcels)
decline_rates_initial <- build_decline_rates_multi(parcels, condition_change = 'decline', mean_decline_rate = 0.02, decline_rate_std = 0.01, global_params$eco_dims)
cfacs <- build_cfacs_by_parcel_multi(global_params, decline_rates_initial, 1:(parcels$land_parcel_num), land_parcels, initial_ecology, (time_horizon = global_params$time_steps - 1))
cfac_parcel_trajs <- find_parcel_traj_by_list(cfacs, global_params$time_steps)
region_params = list()
region_params[[1]] <- populate_region_list(offset_parcel_selection_type = 'regional',  offset_parcel_for_parcel = TRUE, offset_multiplier = 1)
outs = list()
outs$model_outputs <- run_system(global_params, region_params, current_ecology = initial_ecology, decline_rates = decline_rates_initial, parcels, index_object)
outs$parcel_sets_cfacs <- calc_parcel_set_cfacs(outs$model_outputs, global_params, decline_rates_initial)
setWD('~/Documents/R_codes')
setwd('~/Documents/R_codes')
rm(list = ls())
WD = getwd()
strt<-Sys.time()
source('offsets_functions_current.R')
source('Global_Regional_Params.R')
.libPaths('~/Library/R/3.2/library')
library(foreach)
library(doParallel)
library(abind)
write_pdf = FALSE
print_folder = '~/Documents/'
realisation_num = 5
offset_calc_type = 'restoration_from_cfac'   #'avoided degredation', 'restoration_from_cfac', 'parcel_condition_value', 'restoration_gains', 'restoration_condition_value'
dev_calc_type = 'future_condition'                     #'future_condition', 'current_condition'
offset_action_type = 'maintain'                         #'protect', 'maintain', 'restore'
cfac_type = 'standard_cfac'               #'standard_cfac', 'include_clearing', 'include_clearing_offsets'
offset_time_horizon = 40
global_params <- initialise_global_params(offset_calc_type, dev_calc_type, offset_action_type, cfac_type, offset_time_horizon)
parcels <- initialise_shape_parcels(global_params)
land_parcels <- parcels$land_parcels
index_object <- initialise_index_object(parcels, global_params)
initial_ecology <- initialise_ecology(global_params, land_parcels)
decline_rates_initial <- build_decline_rates_multi(parcels, condition_change = 'decline', mean_decline_rate = 0.02, decline_rate_std = 0.01, global_params$eco_dims)
cfacs <- build_cfacs_by_parcel_multi(global_params, decline_rates_initial, 1:(parcels$land_parcel_num), land_parcels, initial_ecology, (time_horizon = global_params$time_steps - 1))
cfac_parcel_trajs <- find_parcel_traj_by_list(cfacs, global_params$time_steps)
region_params = list()
region_params[[1]] <- populate_region_list(offset_parcel_selection_type = 'regional',  offset_parcel_for_parcel = TRUE, offset_multiplier = 1)
outs = list()
outs$model_outputs <- run_system(global_params, region_params, current_ecology = initial_ecology, decline_rates = decline_rates_initial, parcels, index_object)
outs$parcel_sets_cfacs <- calc_parcel_set_cfacs(outs$model_outputs, global_params, decline_rates_initial)
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
getwd
getwd()
setwd('~/Documents/R_codes/')
rm(list = ls())
WD = getwd()
strt<-Sys.time()
source('offsets_functions_current.R')
source('Global_Regional_Params.R')
.libPaths('~/Library/R/3.2/library')
library(foreach)
library(doParallel)
library(abind)
write_pdf = FALSE
print_folder = '~/Documents/'
realisation_num = 5
offset_calc_type = 'restoration_from_cfac'   #'avoided degredation', 'restoration_from_cfac', 'parcel_condition_value', 'restoration_gains', 'restoration_condition_value'
dev_calc_type = 'future_condition'                     #'future_condition', 'current_condition'
offset_action_type = 'maintain'                         #'protect', 'maintain', 'restore'
cfac_type = 'standard_cfac'               #'standard_cfac', 'include_clearing', 'include_clearing_offsets'
offset_time_horizon = 40
global_params <- initialise_global_params(offset_calc_type, dev_calc_type, offset_action_type, cfac_type, offset_time_horizon)
parcels <- initialise_shape_parcels(global_params)
land_parcels <- parcels$land_parcels
index_object <- initialise_index_object(parcels, global_params)
initial_ecology <- initialise_ecology(global_params, land_parcels)
decline_rates_initial <- build_decline_rates_multi(parcels, condition_change = 'decline', mean_decline_rate = 0.02, decline_rate_std = 0.01, global_params$eco_dims)
cfacs <- build_cfacs_by_parcel_multi(global_params, decline_rates_initial, 1:(parcels$land_parcel_num), land_parcels, initial_ecology, (time_horizon = global_params$time_steps - 1))
cfac_parcel_trajs <- find_parcel_traj_by_list(cfacs, global_params$time_steps)
region_params = list()
region_params[[1]] <- populate_region_list(offset_parcel_selection_type = 'regional',  offset_parcel_for_parcel = TRUE, offset_multiplier = 1)
outs = list()
outs$model_outputs <- run_system(global_params, region_params, current_ecology = initial_ecology, decline_rates = decline_rates_initial, parcels, index_object)
outs$parcel_sets_cfacs <- calc_parcel_set_cfacs(outs$model_outputs, global_params, decline_rates_initial)
setwd('~/Documents/R_codes/Offsets_Working_Feb_3/')
rm(list = ls())
WD = getwd()
strt<-Sys.time()
source('offsets_functions_current.R')
source('Global_Regional_Params.R')
.libPaths('~/Library/R/3.2/library')
library(foreach)
library(doParallel)
library(abind)
write_pdf = FALSE
print_folder = '~/Documents/'
realisation_num = 5
offset_calc_type = 'restoration_from_cfac'   #'avoided degredation', 'restoration_from_cfac', 'parcel_condition_value', 'restoration_gains', 'restoration_condition_value'
dev_calc_type = 'future_condition'                     #'future_condition', 'current_condition'
offset_action_type = 'maintain'                         #'protect', 'maintain', 'restore'
cfac_type = 'standard_cfac'               #'standard_cfac', 'include_clearing', 'include_clearing_offsets'
offset_time_horizon = 40
global_params <- initialise_global_params(offset_calc_type, dev_calc_type, offset_action_type, cfac_type, offset_time_horizon)
parcels <- initialise_shape_parcels(global_params)
land_parcels <- parcels$land_parcels
index_object <- initialise_index_object(parcels, global_params)
initial_ecology <- initialise_ecology(global_params, land_parcels)
decline_rates_initial <- build_decline_rates_multi(parcels, condition_change = 'decline', mean_decline_rate = 0.02, decline_rate_std = 0.01, global_params$eco_dims)
cfacs <- build_cfacs_by_parcel_multi(global_params, decline_rates_initial, 1:(parcels$land_parcel_num), land_parcels, initial_ecology, (time_horizon = global_params$time_steps - 1))
cfac_parcel_trajs <- find_parcel_traj_by_list(cfacs, global_params$time_steps)
region_params = list()
region_params[[1]] <- populate_region_list(offset_parcel_selection_type = 'regional',  offset_parcel_for_parcel = TRUE, offset_multiplier = 1)
outs = list()
outs$model_outputs <- run_system(global_params, region_params, current_ecology = initial_ecology, decline_rates = decline_rates_initial, parcels, index_object)
outs$parcel_sets_cfacs <- calc_parcel_set_cfacs(outs$model_outputs, global_params, decline_rates_initial)
outputs = outs$model_outputs
land_parcels = parcels$land_parcels
trajectories = outputs$trajectories
time_steps = global_params$time_steps
parcel_set_ind = 1
current_sets_object = outputs$offsets
current_parcel_set = current_sets_object[[parcel_set_ind]]
decline_rates = decline_rates_initial
parcel_count_ind = 1
parcel_sets_cfacs = outs$parcel_sets_cfacs
current_cfac_sets_object = parcel_sets_cfacs$offsets
parcel_sets_object = list()
traj_list = convert_trajectories_to_list(outputs$trajectories, land_parcels, parcel_indexes = 1:length(land_parcels))
eco_dims = 1
traj_list = convert_trajectories_to_list(outputs$trajectories, land_parcels, parcel_indexes = 1:length(land_parcels), global_params$eco_dims)
convert_trajectories_to_list <- function(trajectories, land_parcels, parcel_indexes, eco_dims){
parcel_num = length(parcel_indexes)
traj_list = vector('list', parcel_num)
for (parcel_cont_ind in seq_len(parcel_num)){
current_parcel_traj = vector('list', eco_dims)
for (eco_ind in seq_len(eco_dims)){
current_parcel = select_land_parcel(land_parcels, current_parcel_ind = parcel_indexes[parcel_count_ind])
current_parcel_traj[[eco_ind]] = extract_3D_parcel(current_parcel, trajectories[[eco_ind]][, , ])
}
traj_list[[parcel_count_ind]] = current_parcel_traj
}
return(traj_list)
}
traj_list = convert_trajectories_to_list(outputs$trajectories, land_parcels, parcel_indexes = 1:length(land_parcels), global_params$eco_dims)
current_sets_object$yr
current_sets_object$parcel_sums
summary(traj_list)
summary(traj_list[[1]])
convert_trajectories_to_list <- function(trajectories, land_parcels, parcel_indexes, eco_dims){
parcel_num = length(parcel_indexes)
traj_list = vector('list', parcel_num)
for (parcel_count_ind in seq_len(parcel_num)){
current_parcel_traj = vector('list', eco_dims)
for (eco_ind in seq_len(eco_dims)){
current_parcel = select_land_parcel(land_parcels, current_parcel_ind = parcel_indexes[parcel_count_ind])
current_parcel_traj[[eco_ind]] = extract_3D_parcel(current_parcel, trajectories[[eco_ind]][, , ])
}
traj_list[[parcel_count_ind]] = current_parcel_traj
}
return(traj_list)
}
parcel_sets_object = list()
traj_list = convert_trajectories_to_list(outputs$trajectories, land_parcels, parcel_indexes = 1:length(land_parcels), global_params$eco_dims)
summary(traj_list)
a = array(1, c(1,2,3))
a
apply(a, 3, sum)
sum_parcel_trajectories <- function(traj_list, eco_dims, time_steps, parcel_indexes){
parcel_num = length(parcel_indexes)
parcel_trajs = array(0, c(global_params$time_steps, parcel_num, eco_dims))
for (parcel_count_ind in seq_len(parcel_num)){
for (eco_dim in seq_len(eco_dims)){
parcel_trajs[, parcel_count_ind, ] = apply(traj_list[[parcel_count_ind]][[eco_ind]], MARGIN=3, sum)
}
}
return(parcel_trajs)
}
parcel_trajs <- sum_parcel_trajectories(traj_list, eco_dims = 2, time_steps = global_params$time_steps, parcel_indexes = 1:2)
sum_parcel_trajectories <- function(traj_list, eco_dims, time_steps, parcel_indexes){
parcel_num = length(parcel_indexes)
parcel_trajs = array(0, c(global_params$time_steps, parcel_num, eco_dims))
for (parcel_count_ind in seq_len(parcel_num)){
for (eco_ind in seq_len(eco_dims)){
parcel_trajs[, parcel_count_ind, ] = apply(traj_list[[parcel_count_ind]][[eco_ind]], MARGIN=3, sum)
}
}
return(parcel_trajs)
}
parcel_trajs <- sum_parcel_trajectories(traj_list, eco_dims = 2, time_steps = global_params$time_steps, parcel_indexes = 1:2)
parcel_indexes = 1:2
eco_dims = 1
parcel_num = length(parcel_indexes)
parcel_trajs = array(0, c(global_params$time_steps, parcel_num, eco_dims))
for (parcel_count_ind in seq_len(parcel_num)){
for (eco_ind in seq_len(eco_dims)){
parcel_trajs[, parcel_count_ind, ] = apply(traj_list[[parcel_count_ind]][[eco_ind]], MARGIN=3, sum)
}
}
parcel_trajs
sum_parcel_trajectories <- function(traj_list, eco_dims, time_steps, parcel_indexes){
parcel_num = length(parcel_indexes)
parcel_trajs = array(0, c(global_params$time_steps, parcel_num, eco_dims))
for (parcel_count_ind in seq_len(parcel_num)){
for (eco_ind in seq_len(eco_dims)){
parcel_trajs[, parcel_count_ind, ] = apply(traj_list[[parcel_count_ind]][[eco_ind]], MARGIN=3, sum)
}
}
return(parcel_trajs)
}
parcel_trajs <- sum_parcel_trajectories(traj_list, eco_dims = 1, time_steps = global_params$time_steps, parcel_indexes = 1:2)
parcel_trajs
parcel_trajs <- sum_parcel_trajectories(traj_list, eco_dims = 1, time_steps = global_params$time_steps, parcel_indexes = 1:100)
parcel_trajs <- sum_parcel_trajectories(traj_list, eco_dims = 1, time_steps = global_params$time_steps, parcel_indexes = outputs$offset_list)
parcel_trajs
source('~/Documents/R_Codes/Offsets_Working_Feb_3/run_model.R', echo=TRUE)
outs$parcel_sets_cfacs
outputs = outs$model_outputs
land_parcels = parcels$land_parcels
trajectories = outputs$trajectories
time_steps = global_params$time_steps
parcel_set_ind = 1
current_sets_object = outputs$offsets
current_parcel_set = current_sets_object[[parcel_set_ind]]
decline_rates = decline_rates_initial
parcel_count_ind = 1
parcel_sets_cfacs = outs$parcel_sets_cfacs
current_cfac_sets_object = parcel_sets_cfacs$offsets
parcel_sets_object = list()
traj_list = convert_trajectories_to_list(outputs$trajectories, land_parcels, parcel_indexes = 1:length(land_parcels), global_params$eco_dims)
parcel_sets_object$offsets = collate_parcel_set(outputs$offsets, parcel_sets_cfacs$offsets, land_parcels, traj_list, global_params, decline_rates)
current_sets_object$parcel_indexes
current_sets_object$parcel_ecologies
current_sets_object$parcel_indexes
